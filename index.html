<!DOCTYPE html>
<html>
<head>
<title>Project Title</title>
<meta charset="utf-t">
<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
<style> @-ms-viewport { width: device-width; } </style>
<link rel="stylesheet" href="vendor/reset.min.css">
<link rel="stylesheet" href="style.css">

<style>
  #gyro-button-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    text-align: center;
  }
  #gyro-button {
    padding: 12px 24px;
    font-size: 16px;
    color: white;
    background-color: rgba(0, 0, 0, 0.7);
    border: 1px solid white;
    border-radius: 8px;
    cursor: pointer;
    outline: none;
    transition: background-color 0.3s;
  }
  #gyro-button:hover {
    background-color: rgba(0, 0, 0, 0.9);
  }
</style>

</head>
<body class="multiple-scenes view-control-buttons">

<div id="gyro-button-container">
  <button id="gyro-button">Activar Giroscopio</button>
</div>

<div id="pano"></div>

<div id="sceneList">
  <ul class="scenes">
    
      <a href="javascript:void(0)" class="scene" data-id="0-exterior">
        <li class="text">Exterior</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="1-02_360-sunset-in-paradise">
        <li class="text">02_360 Sunset in paradise</li>
      </a>
    
  </ul>
</div>

<div id="titleBar">
  <h1 class="sceneName"></h1>
</div>

<a href="javascript:void(0)" id="autorotateToggle">
  <img class="icon off" src="img/play.png">
  <img class="icon on" src="img/pause.png">
</a>

<a href="javascript:void(0)" id="fullscreenToggle">
  <img class="icon off" src="img/fullscreen.png">
  <img class="icon on" src="img/windowed.png">
</a>

<a href="javascript:void(0)" id="sceneListToggle">
  <img class="icon off" src="img/expand.png">
  <img class="icon on" src="img/collapse.png">
</a>

<a href="javascript:void(0)" id="viewUp" class="viewControlButton viewControlButton-1">
  <img class="icon" src="img/up.png">
</a>
<a href="javascript:void(0)" id="viewDown" class="viewControlButton viewControlButton-2">
  <img class="icon" src="img/down.png">
</a>
<a href="javascript:void(0)" id="viewLeft" class="viewControlButton viewControlButton-3">
  <img class="icon" src="img/left.png">
</a>
<a href="javascript:void(0)" id="viewRight" class="viewControlButton viewControlButton-4">
  <img class="icon" src="img/right.png">
</a>
<a href="javascript:void(0)" id="viewIn" class="viewControlButton viewControlButton-5">
  <img class="icon" src="img/plus.png">
</a>
<a href="javascript:void(0)" id="viewOut" class="viewControlButton viewControlButton-6">
  <img class="icon" src="img/minus.png">
</a>

<script src="vendor/screenfull.min.js" ></script>
<script src="vendor/bowser.min.js" ></script>
<script src="vendor/marzipano.js" ></script>

<script src="data.js"></script>
<script src="index.js"></script>

<!-- SCRIPT DEL GIROSCOPIO MEJORADO Y CORREGIDO -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var gyroButtonContainer = document.getElementById('gyro-button-container');
    var gyroButton = document.getElementById('gyro-button');

    // Comprueba si el navegador necesita pedir permiso
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      
      gyroButtonContainer.style.display = 'block';

      gyroButton.addEventListener('click', function() {
        DeviceOrientationEvent.requestPermission()
          .then(function(permissionState) {
            if (permissionState === 'granted') {
              // El usuario dio permiso, ocultamos el botón
              gyroButtonContainer.style.display = 'none';
              
              // *** ESTA ES LA PARTE NUEVA Y CRÍTICA ***
              // Le decimos a Marzipano que reactive el control del giroscopio
              if (window.marzipanoViewer) {
                var controls = window.marzipanoViewer.controls();
                controls.enableMethod('deviceOrientation');
              }

            } else {
              alert('Permiso para el giroscopio denegado. No podrás mover la vista con el teléfono.');
            }
          })
          .catch(function(error) {
            console.error('Error al solicitar permiso del giroscopio:', error);
            alert('Hubo un error al intentar activar el giroscopio.');
          });
      });
    } else {
      // Si no se necesita permiso (ej. Android), simplemente ocultamos el botón
      gyroButtonContainer.style.display = 'none';
    }
  });
</script>

</body>
</html>